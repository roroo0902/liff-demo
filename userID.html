<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google è¡¨å–®å¡«å¯«</title>
</head>
<body>
    <h1 id="status">æ­£åœ¨è™•ç†è³‡æ–™...</h1>

    <script>
        document.addEventListener("DOMContentLoaded", async function () {
            try {
                // âœ… è®€å– `localStorage` å…§çš„ `userId` å’Œ `userName`
                const userName = localStorage.getItem("userName") || "æœªçŸ¥ä½¿ç”¨è€…";
                const userId = localStorage.getItem("userId") || "æœªçŸ¥ ID";

                if (!userName || !userId) {
                    console.warn("âš ï¸ ç„¡æ³•ç²å–ä½¿ç”¨è€…è³‡è¨Šï¼Œç›´æ¥è·³è½‰ Google è¡¨å–®...");
                    redirectToGoogleForm();
                    return;
                }

                console.log("âœ… ç²å–ä½¿ç”¨è€…åç¨±:", userName);
                console.log("âœ… ç²å–ä½¿ç”¨è€… ID:", userId);

                // âœ… `Google Apps Script` ç«¯é»
                const googleScriptURL = "https://script.google.com/macros/s/AKfycbx1DEq-zz_JIYRbI1dEq4ypyzgLHqgQEaq8A18jAjXIDjFlT5gpiQDldImt2aVMPQ-2Rw/exec";

                // âœ… é€ `userName` å’Œ `userId` åˆ° `Google Apps Script`
                await fetch(`${googleScriptURL}?userName=${encodeURIComponent(userName)}&userId=${encodeURIComponent(userId)}`, { 
                    mode: 'no-cors' 
                });

                console.log("âœ… è³‡æ–™å·²è¨˜éŒ„åˆ° Google è©¦ç®—è¡¨");
                document.getElementById("status").innerText = "è³‡æ–™è¨˜éŒ„å®Œæˆï¼Œæ­£åœ¨è·³è½‰åˆ° Google è¡¨å–®...";

                // âœ… **å»¶é² 1 ç§’ï¼Œç¢ºä¿ `fetch()` å®Œæˆ**
                setTimeout(() => {
                    redirectToGoogleForm();
                }, 1000);

            } catch (err) {
                console.error("âŒ ç™¼ç”ŸéŒ¯èª¤:", err);
                redirectToGoogleForm();
            }
        });

        function redirectToGoogleForm() {
            console.log("ğŸ”¹ è½‰è·³åˆ° Google è¡¨å–®...");
            document.getElementById("status").innerText = "è½‰è·³åˆ° Google è¡¨å–®...";
            window.location.href = "https://docs.google.com/forms/d/e/1FAIpQLSevkZz6ffohW_iUzzGp0Bzmq5TE2gHb3TEBVzQzI5JUcDhm8A/viewform?usp=pp_url";
        }
    </script>
</body>
</html>
