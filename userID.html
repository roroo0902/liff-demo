<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>LIFF 登入</title>
  <!-- 引入 LIFF SDK -->
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body>
  <h1>正在登入...</h1>

  <script>
    document.addEventListener("DOMContentLoaded", initLiff);

    /**
     * 主流程：初始化 LIFF、檢查登入狀態、取得使用者資料
     */
    async function initLiff() {
      try {
        // 1. 初始化 LIFF
        await liff.init({ liffId: "2007051903-2ajakdbl" }); // <-- 請替換成你的 LIFF ID

        // 2. 檢查登入狀態
        if (!liff.isLoggedIn()) {
          liff.login();
        } else {
          await getUserProfile();
        }
      } catch (err) {
        console.error("❌ LIFF 初始化失敗:", err);
        redirectToGoogleForm();
      }
    }

    /**
     * 取得使用者資訊並存入 localStorage
     */
    async function getUserProfile() {
      try {
        const profile = await liff.getProfile();
        localStorage.setItem("userName", profile.displayName);
        localStorage.setItem("userId", profile.userId);

        // 跳轉至 userID.html
        window.location.href = "userID.html";
      } catch (err) {
        console.error("❌ 獲取用戶資訊失敗:", err);
        redirectToGoogleForm();
      }
    }

    /**
     * 轉跳 Google 表單
     */
    function redirectToGoogleForm() {
      console.log("🔹 轉跳到 Google 表單...");
      window.location.href =
        "https://docs.google.com/forms/d/e/1FAIpQLSevkZz6ffohW_iUzzGp0Bzmq5TE2gHb3TEBVzQzI5JUcDhm8A/viewform?usp=pp_url";
    }
  </script>
</body>
</html>
