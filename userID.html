<script>
    document.addEventListener("DOMContentLoaded", function () {
        liff.init({ liffId: "2007051903-2ajakdbl" })
            .then(() => {
                if (!liff.isLoggedIn()) {
                    liff.login();
                } else {
                    submitToGoogleSheet();
                }
            })
            .catch(err => console.error("LIFF 初始化失敗:", err));
    });

    function submitToGoogleSheet() {
        liff.getProfile()
            .then(profile => {
                console.log("使用者名稱:", profile.displayName);
                console.log("使用者 ID:", profile.userId);

                const userName = encodeURIComponent(profile.displayName);
                const userId = encodeURIComponent(profile.userId);

                const googleScriptURL = "https://script.google.com/macros/s/AKfycbxsCT0zroN3yww6JLVjrBJ9xJU3HxnOwREGLPGvCqyOuJpWP9wguT4l3BInF2s_7zdWvA/exec";

                fetch(`${googleScriptURL}?userName=${userName}&userId=${userId}`, { mode: 'no-cors' })
                    .then(() => {
                        console.log("Google 試算表已更新！");
                        alert("資料已成功提交！");
                        liff.closeWindow(); 
                    })
                    .catch(err => console.error("提交失敗:", err));
            })
            .catch(err => {
                console.error("獲取用戶資訊失敗:", err);
                alert("無法獲取使用者資訊，請確保 LIFF 權限已正確設定。");
            });
    }
</script>

