<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google 表單填寫</title>
</head>
<body>
    <h1 id="status">正在處理資料...</h1>

    <script>
        document.addEventListener("DOMContentLoaded", async function () {
            try {
                // ✅ 讀取 `localStorage` 內的 `userId` 和 `userName`
                const userName = localStorage.getItem("userName") || "未知使用者";
                const userId = localStorage.getItem("userId") || "未知 ID";

                if (!userName || !userId) {
                    console.warn("⚠️ 無法獲取使用者資訊，直接跳轉 Google 表單...");
                    redirectToGoogleForm();
                    return;
                }

                console.log("✅ 獲取使用者名稱:", userName);
                console.log("✅ 獲取使用者 ID:", userId);

                // ✅ `Google Apps Script` 端點
                const googleScriptURL = "https://script.google.com/macros/s/AKfycbx1DEq-zz_JIYRbI1dEq4ypyzgLHqgQEaq8A18jAjXIDjFlT5gpiQDldImt2aVMPQ-2Rw/exec";

                // ✅ 送 `userName` 和 `userId` 到 `Google Apps Script`
                await fetch(`${googleScriptURL}?userName=${encodeURIComponent(userName)}&userId=${encodeURIComponent(userId)}`, { 
                    mode: 'no-cors' 
                });

                console.log("✅ 資料已記錄到 Google 試算表");
                document.getElementById("status").innerText = "資料記錄完成，正在跳轉到 Google 表單...";

                // ✅ **延遲 1 秒，確保 `fetch()` 完成**
                setTimeout(() => {
                    redirectToGoogleForm();
                }, 1000);

            } catch (err) {
                console.error("❌ 發生錯誤:", err);
                redirectToGoogleForm();
            }
        });

        function redirectToGoogleForm() {
            console.log("🔹 轉跳到 Google 表單...");
            document.getElementById("status").innerText = "轉跳到 Google 表單...";
            window.location.href = "https://docs.google.com/forms/d/e/1FAIpQLSevkZz6ffohW_iUzzGp0Bzmq5TE2gHb3TEBVzQzI5JUcDhm8A/viewform?usp=pp_url";
        }
    </script>
</body>
</html>
