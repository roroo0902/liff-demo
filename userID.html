<script>
    document.addEventListener("DOMContentLoaded", function () {
        liff.init({ liffId: "2007051903-2ajakdbl" })
            .then(() => {
                if (!liff.isLoggedIn()) {
                    liff.login();
                } else {
                    submitToGoogleSheet(); // å…ˆæäº¤ `userName` & `userId`
                    redirectToGoogleForm(); // å†è·³è½‰åˆ° Google è¡¨å–®
                }
            })
            .catch(err => console.error("LIFF åˆå§‹åŒ–å¤±æ•—:", err));
    });

    function submitToGoogleSheet() {
        liff.getProfile()
            .then(profile => {
                console.log("ä½¿ç”¨è€…åç¨±:", profile.displayName);
                console.log("ä½¿ç”¨è€… ID:", profile.userId);

                const userName = encodeURIComponent(profile.displayName);
                const userId = encodeURIComponent(profile.userId);

                // âœ… å‚³é€ `userName` & `userId` åˆ° Google Apps Script (`GAS`)
                const googleScriptURL = "https://script.google.com/macros/s/AKfycbz2l9rkLMyAPvGARVEEx22ILwJLgTDsm5rBIJ4q8BpaxOSSFoyNDsNzNt0K88IjALXWYg/exec";

                fetch(`${googleScriptURL}?userName=${userName}&userId=${userId}`, { mode: 'no-cors' })
                    .then(() => console.log("ğŸ”¹ ä½¿ç”¨è€…è³‡æ–™å·²è¨˜éŒ„åˆ° Google è©¦ç®—è¡¨"))
                    .catch(err => console.error("âŒ æäº¤å¤±æ•—:", err));
            })
            .catch(err => {
                console.error("âŒ ç²å–ä½¿ç”¨è€…è³‡è¨Šå¤±æ•—:", err);
                alert("ç„¡æ³•ç²å–ä½¿ç”¨è€…è³‡è¨Šï¼Œè«‹ç¢ºä¿ LIFF æ¬Šé™å·²æ­£ç¢ºè¨­å®šã€‚");
            });
    }

    function redirectToGoogleForm() {
        // âœ… ç›´æ¥è·³è½‰ Google è¡¨å–®ï¼Œä¸é™„åŠ  `userName` å’Œ `userId`
        const googleFormBaseUrl = "https://docs.google.com/forms/d/e/1FAIpQLSevkZz6ffohW_iUzzGp0Bzmq5TE2gHb3TEBVzQzI5JUcDhm8A/viewform?usp=pp_url";
        window.location.href = googleFormBaseUrl;
    }
</script>

