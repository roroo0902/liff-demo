<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>LIFF ç™»å…¥</title>
  <!-- å¼•å…¥ LIFF SDK -->
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body>
  <h1>æ­£åœ¨ç™»å…¥...</h1>

  <script>
    document.addEventListener("DOMContentLoaded", initLiff);

    /**
     * ä¸»æµç¨‹ï¼šåˆå§‹åŒ– LIFFã€æª¢æŸ¥ç™»å…¥ç‹€æ…‹ã€å–å¾—ä½¿ç”¨è€…è³‡æ–™
     */
    async function initLiff() {
      try {
        // 1. åˆå§‹åŒ– LIFF
        await liff.init({ liffId: "2007051903-2ajakdbl" }); // <-- è«‹æ›¿æ›æˆä½ çš„ LIFF ID

        // 2. æª¢æŸ¥ç™»å…¥ç‹€æ…‹
        if (!liff.isLoggedIn()) {
          liff.login();
        } else {
          await getUserProfile();
        }
      } catch (err) {
        console.error("âŒ LIFF åˆå§‹åŒ–å¤±æ•—:", err);
        redirectToGoogleForm();
      }
    }

    /**
     * å–å¾—ä½¿ç”¨è€…è³‡è¨Šä¸¦å­˜å…¥ localStorage
     */
    async function getUserProfile() {
      try {
        const profile = await liff.getProfile();
        localStorage.setItem("userName", profile.displayName);
        localStorage.setItem("userId", profile.userId);

        // è·³è½‰è‡³ userID.html
        window.location.href = "userID.html";
      } catch (err) {
        console.error("âŒ ç²å–ç”¨æˆ¶è³‡è¨Šå¤±æ•—:", err);
        redirectToGoogleForm();
      }
    }

    /**
     * è½‰è·³ Google è¡¨å–®
     */
    function redirectToGoogleForm() {
      console.log("ğŸ”¹ è½‰è·³åˆ° Google è¡¨å–®...");
      window.location.href =
        "https://docs.google.com/forms/d/e/1FAIpQLSevkZz6ffohW_iUzzGp0Bzmq5TE2gHb3TEBVzQzI5JUcDhm8A/viewform?usp=pp_url";
    }
  </script>
</body>
</html>
